{% extends "base.html" %}{% set admin_area=True %}
{% block title %}Schedule{% endblock %}

{% macro format_time(time) -%}
  {% if not time.minute %}
    {{ time|datetime("%-I%p")|lower }}
  {% else %}
    {{ time|datetime("%-I:%M") }}
  {% endif %}
{%- endmacro %}

{% macro format_day(time) -%}
  {% if (not time.hour and not time.minute) or (time == c.EPOCH) or (time.hour == 12 and not time.minute) %}
    {{ time|datetime("%a") }}
  {% endif %}
{%- endmacro %}

{% macro format_day_column(time) -%}
  {%- set has_day = (not time.hour and not time.minute) or (time <= c.EPOCH) or (time.hour == 12 and not time.minute) -%}
  <td class="text-right panels{% if has_day %} has-day{% endif %}">
    {% if has_day %}{{ time|datetime('%a') }}{% endif %}
    <a name="{{ time|datetime('%Y-%m-%d %H:%i:%s') }}"></a>
    {{ format_time(time) }}
  </td>
{%- endmacro %}

{% block content %}
{% include "panels_common.html" %}

<div class="schedule-header">
  <div class="text-center">
    <label><input type="checkbox" id="show_only_panels"> Show only panels rooms</label>
    <div class="text-danger"><b>Note:</b> This schedule is not final.</div>
  </div>
</div>

<div class="schedule-table">
  <table cellspacing="0" cellpadding="0">
    <thead>
      <tr>
        <th class="panels">&nbsp;<br>&nbsp;</th>
        {% for id, name, colspan in max_simul %}
          {%- set is_panels = c.ORDERED_EVENT_LOCS[loop.index0] in c.PANEL_ROOMS -%}
          <th colspan="{{ colspan }}"{% if is_panels %} class="panels"{% endif %}>
            {%- for s in name.split('(', 1) -%}
              {%- if not loop.first -%}
                <br><span class="text-nowrap">(
              {%- else -%}
                <span class="text-nowrap">
              {%- endif -%}{{ s|trim }}</span>
            {%- endfor -%}
          </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for time, events in schedule %}
        <tr>
          {{ format_day_column(time) }}
          {% for location, event_list in events %}
            {%- set is_panels = c.ORDERED_EVENT_LOCS[loop.index0] in c.PANEL_ROOMS -%}
            {% for event in event_list %}
              {% if event.colspan %}
                <td
                    rowspan="{{ event.duration|default(1) }}"
                    colspan="{{ event.colspan }}"
                    class="schedule{% if event.id %} box{% endif %}{% if is_panels %} panels{% endif %}"
                    id='{{ event.id|default("None") }},{{ location }},{{ time|datetime("%Y-%m-%d %H:%i:%s") }}'
                    {% if event.description %}
                      title="{{ event.description }}"
                    {% endif %}>
                  {{ event.name }}
                </td>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
