{% extends "base.html" %}{% set admin_area=True %}
{% block title %}Schedule{% endblock %}

{% macro format_time(time) -%}
  {% if not time.minute %}
    {{ time|datetime("%-I%p")|lower }}
  {% else %}
    {{ time|datetime("%-I:%M") }}
  {% endif %}
{%- endmacro %}

{% macro format_day(time) -%}
  {% if (not time.hour and not time.minute) or (time == c.EPOCH) or (time.hour == 12 and not time.minute) %}
    {{ time|datetime("%a") }}
  {% endif %}
{%- endmacro %}

{% macro format_day_column(time) -%}
  {%- set has_day = (not time.hour and not time.minute) or (time == c.EPOCH) or (time.hour == 12 and not time.minute) -%}
  <td class="text-right{% if has_day %} has-day{% endif %}">
    {% if has_day %}{{ time|datetime('%a') }}{% endif %}
    <a name="{{ time|datetime('%Y-%m-%d %H:%i:%s') }}"></a>
    {{ format_time(time) }}
  </td>
{%- endmacro %}

{% block content %}

<style type="text/css">
  .schedule-header p {
    margin: 10px 0;
  }

  .has-day {
    font-weight: bold;
  }

  .schedule-table th {
    height: 60px;
    padding: 5px 10px;
    text-align: center;
  }

  .schedule-table td {
    height: 30px;
    padding: 2px;
  }

  .schedule-table td.schedule,
  .schedule-table th.schedule {
    text-align: center;
    vertical-align: middle;
  }

  .schedule-table thead {
    text-align: center;
  }

  .schedule-table {
    width: 100%;
    overflow: auto;
    border: 1px solid #ddd;
  }

  .schedule-table table {
    font-size: 9pt;
    border-collapse: collapse;
    margin-left: 72px;
  }

  .schedule-table th, .schedule-table td {
    border: 0 none transparent;
    border-right: 1px solid #f0f0f0;
  }

  .schedule-table th:last-child,
  .schedule-table td:last-child {
    border-right: 0 none transparent;
  }

  .schedule-table thead tr {
    border-bottom: 1px solid #ddd;
  }

  .schedule-table tbody tr {
    border-bottom: 1px solid #eee;
  }

  .schedule-table tr:hover {
    background-color: #f0f0f0;
  }

  .schedule-table thead tr:hover {
    background-color: inherit;
  }

  .schedule-table tbody td:hover {
    background-color: #f0f0f0;
  }

  .schedule-table td.event {
    border: 2px solid #ddd;
    background-color: #ffd;
  }

  .schedule-table td.event:hover {
    border: 2px solid #c0c0c0;
    background-color: #ff8;
  }

  .schedule-table > table > * > tr > th:first-child,
  .schedule-table > table > * > tr > td:first-child {
    position: absolute;
    width: 72px;
    margin-left: -72px;
    background-color: #fff;
    border-bottom: 1px solid #ddd;
    border-right: 1px solid #ddd;
  }

  .schedule-table > table > * > tr:hover > td:first-child {
    background-color: #f0f0f0;
  }
</style>

<div class="schedule-header">
  <p class="text-danger text-center">
    <b>Note:</b> This schedule is not final.
  </p>
</div>

<div class="schedule-table">
  <table>
    <thead>
      <tr>
        <th>&nbsp;<br>&nbsp;</th>
        {% for id, name, colspan in max_simul %}
          <th colspan="{{ colspan }}">
            {%- for s in name.split('(', 1) -%}
              {%- if not loop.first -%}
                <br><span class="text-nowrap">(
              {%- else -%}
                <span class="text-nowrap">
              {%- endif -%}{{ s|trim }}</span>
            {%- endfor -%}
          </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for time, events in schedule %}
        <tr>
          {{ format_day_column(time) }}
          {% for location, event_list in events %}
            {% for event in event_list %}
              {% if event.colspan %}
                <td
                    rowspan="{{ event.duration|default(1) }}"
                    colspan="{{ event.colspan }}"
                    class="schedule{% if event.id %} event{% endif %}"
                    id='{{ event.id|default("None") }},{{ location }},{{ time|datetime("%Y-%m-%d %H:%i:%s") }}'
                    {% if event.description %}
                      title="{{ event.description }}"
                    {% endif %}>
                  {{ event.name }}
                </td>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
